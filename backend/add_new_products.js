const sqlite3 = require('sqlite3').verbose();
const path = require('path');

// –ü—É—Ç—å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
const dbPath = path.join(__dirname, 'data/mnogo_rolly.db');

// –°–æ–∑–¥–∞–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
const db = new sqlite3.Database(dbPath);

console.log('üå± –°–∫—Ä–∏–ø—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –∑–∞–ø—É—â–µ–Ω');
console.log('üìÅ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:', dbPath);

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç)
function addProduct(name, description, price, imageUrl, category, isPopular = 0, isAvailable = 1) {
  return new Promise((resolve, reject) => {
    // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ç–∞–∫–æ–π —Ç–æ–≤–∞—Ä
    db.get('SELECT id FROM products WHERE name = ?', [name], (err, existing) => {
      if (err) {
        console.error(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–≤–∞—Ä–∞ "${name}":`, err.message);
        reject(err);
        return;
      }
      
      if (existing) {
        console.log(`‚è≠Ô∏è –¢–æ–≤–∞—Ä "${name}" —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º`);
        resolve(existing.id);
        return;
      }
      
      // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä
      const sql = `
        INSERT INTO products (name, description, price, image_url, category, is_popular, is_available, created_at)
        VALUES (?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP)
      `;
      
      db.run(sql, [name, description, price, imageUrl, category, isPopular, isAvailable], function(err) {
        if (err) {
          console.error(`‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ "${name}":`, err.message);
          reject(err);
        } else {
          console.log(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä: ${name} (ID: ${this.lastID})`);
          resolve(this.lastID);
        }
      });
    });
  });
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
async function addNewProducts() {
  console.log('\nüîÑ –ù–∞—á–∏–Ω–∞–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤...');
  
  try {
    // –ö—Ä—ã–ª—å—è (–Ω–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è)
    console.log('\nüçó –î–æ–±–∞–≤–ª—è–µ–º –∫—Ä—ã–ª—å—è...');
    
    await addProduct(
      '–ö—Ä—ã–ª—å—è –∫—É—Ä–∏–Ω—ã–µ 6 —à—Ç',
      '–•—Ä—É—Å—Ç—è—â–∏–µ –∫—É—Ä–∏–Ω—ã–µ –∫—Ä—ã–ª—ã—à–∫–∏ —Å —Å–æ—É—Å–æ–º',
      280,
      'https://images.unsplash.com/photo-1565299624946-b28f40a0ca4b?w=400&h=300&fit=crop',
      'wings',
      1,
      1
    );
    
    await addProduct(
      '–ö—Ä—ã–ª—å—è –∫—É—Ä–∏–Ω—ã–µ 12 —à—Ç',
      '–•—Ä—É—Å—Ç—è—â–∏–µ –∫—É—Ä–∏–Ω—ã–µ –∫—Ä—ã–ª—ã—à–∫–∏ —Å —Å–æ—É—Å–æ–º',
      480,
      'https://images.unsplash.com/photo-1565299624946-b28f40a0ca4b?w=400&h=300&fit=crop',
      'wings',
      0,
      1
    );
    
    await addProduct(
      '–ö—Ä—ã–ª—å—è –∫—É—Ä–∏–Ω—ã–µ 18 —à—Ç',
      '–•—Ä—É—Å—Ç—è—â–∏–µ –∫—É—Ä–∏–Ω—ã–µ –∫—Ä—ã–ª—ã—à–∫–∏ —Å —Å–æ—É—Å–æ–º',
      680,
      'https://images.unsplash.com/photo-1565299624946-b28f40a0ca4b?w=400&h=300&fit=crop',
      'wings',
      0,
      1
    );
    
    // –ù–æ–≤—ã–µ —Ä–æ–ª–ª—ã
    console.log('\nüç£ –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ —Ä–æ–ª–ª—ã...');
    
    await addProduct(
      '–¢–µ–º–ø—É—Ä–∞ —Å –ª–æ—Å–æ—Å–µ–º',
      '–†–∏—Å 140 –≥—Ä, –Ω–æ—Ä–∏ 1 —à—Ç, —Å—ã—Ä 30 –≥—Ä, –æ–≥—É—Ä–µ—Ü 20 –≥—Ä, –ª–æ—Å–æ—Å—å –±—Ä—É—Å–æ–∫ 30 –≥—Ä',
      450,
      'https://images.unsplash.com/photo-1553621042-f6e147245754?w=400&h=300&fit=crop',
      'rolls',
      1,
      1
    );
    
    await addProduct(
      '–ü—Ä–æ—Å—Ç–æ –ª–æ—Å–æ—Å—å',
      '–†–∏—Å 90 –≥—Ä, –Ω–æ—Ä–∏ 1 —à—Ç, –æ–≥—É—Ä–µ—Ü 30 –≥—Ä, –ª–æ—Å–æ—Å—å –±—Ä—É—Å–æ–∫ 30 –≥—Ä',
      380,
      'https://images.unsplash.com/photo-1553621042-f6e147245754?w=400&h=300&fit=crop',
      'rolls',
      1,
      1
    );
    
    await addProduct(
      '–û—Å—Ç—Ä—ã–π –ª–æ—Å–æ—Å—å',
      '–†–∏—Å 140 –≥—Ä, –Ω–æ—Ä–∏ 1 —à—Ç, —Å–ø–∞–π—Å 20 –≥—Ä, –æ–≥—É—Ä–µ—Ü 20 –≥—Ä, –ª–æ—Å–æ—Å—å –±—Ä—É—Å–æ–∫ 30 –≥—Ä',
      420,
      'https://images.unsplash.com/photo-1553621042-f6e147245754?w=400&h=300&fit=crop',
      'rolls',
      0,
      1
    );
    
    await addProduct(
      '–ö–∞–Ω–∞–¥–∞',
      '–†–∏—Å 140 –≥—Ä, –Ω–æ—Ä–∏ 1 —à—Ç, —Å—ã—Ä 30 –≥—Ä, –æ–≥—É—Ä–µ—Ü 20 –≥—Ä, —É–≥–æ—Ä—å —Å–ª–∞–π—Å, —É–Ω–∞–≥–∏ 10 –≥—Ä, –∫—É–Ω–∂—É—Ç 10 –≥—Ä',
      520,
      'https://images.unsplash.com/photo-1553621042-f6e147245754?w=400&h=300&fit=crop',
      'rolls',
      1,
      1
    );
    
    await addProduct(
      '–ó–∞–ø–µ—á–µ–Ω–Ω—ã–π –∫–∞–ª–∏—Ñ–æ—Ä–Ω–∏—è',
      '–†–∏—Å 140 –≥—Ä, –Ω–æ—Ä–∏ 1 —à—Ç, –∫—Ä–∞–±–æ–≤—ã–π –º–∏–∫—Å, –æ–≥—É—Ä–µ—Ü 20 –≥—Ä, —Ç–æ–±–∏–∫–æ –∫—Ä–∞—Å–Ω—ã–π, —Å–æ—É—Å –¥–ª—è –∑–∞–ø–µ–∫–∞–Ω–∏—è',
      480,
      'https://images.unsplash.com/photo-1553621042-f6e147245754?w=400&h=300&fit=crop',
      'rolls',
      0,
      1
    );
    
    await addProduct(
      '–°–Ω–µ–∂–Ω–∞—è –∫–∞–ª–∏—Ñ–æ—Ä–Ω–∏—è',
      '–†–∏—Å 140 –≥—Ä, –Ω–æ—Ä–∏ 1 —à—Ç, –∫—Ä–∞–±–æ–≤—ã–π –º–∏–∫—Å, –æ–≥—É—Ä–µ—Ü 20 –≥—Ä, —Ç–æ–±–∏–∫–æ –∫—Ä–∞—Å–Ω—ã–π 15 –≥—Ä',
      460,
      'https://images.unsplash.com/photo-1553621042-f6e147245754?w=400&h=300&fit=crop',
      'rolls',
      0,
      1
    );
    
    await addProduct(
      '–ó–∞–ø–µ—á–µ–Ω–Ω—ã–π —Å –ª–æ—Å–æ—Å–µ–º',
      '–†–∏—Å 140 –≥—Ä, –Ω–æ—Ä–∏ 1 —à—Ç, —Å—ã—Ä 30 –≥—Ä, –æ–≥—É—Ä–µ—Ü 20 –≥—Ä, –ª–æ—Å–æ—Å—å –±—Ä—É—Å–æ–∫ 30 –≥—Ä, —Å–æ—É—Å –¥–ª—è –∑–∞–ø–µ–∫–∞–Ω–∏—è',
      490,
      'https://images.unsplash.com/photo-1553621042-f6e147245754?w=400&h=300&fit=crop',
      'rolls',
      1,
      1
    );
    
    await addProduct(
      '–ß–∏–∫–∫–µ–Ω —Ä–æ–ª–ª',
      '–†–∏—Å 140 –≥—Ä, –Ω–æ—Ä–∏ 1 —à—Ç, —Å—ã—Ä 30 –≥—Ä, –æ–≥—É—Ä–µ—Ü 20 –≥—Ä, –∫—É—Ä–∏—Ü–∞ 30 –≥—Ä, —Å–æ—É—Å –¥–ª—è –∑–∞–ø–µ–∫–∞–Ω–∏—è',
      420,
      'https://images.unsplash.com/photo-1553621042-f6e147245754?w=400&h=300&fit=crop',
      'rolls',
      0,
      1
    );
    
    await addProduct(
      '–†–æ–ª–ª –ø—Ä–æ—Å—Ç–æ –æ–≥—É—Ä–µ—Ü',
      '–†–∏—Å 90 –≥—Ä, –Ω–æ—Ä–∏ 1 —à—Ç, –æ–≥—É—Ä–µ—Ü 30 –≥—Ä, –∫—É–Ω–∂—É—Ç 10 –≥—Ä',
      280,
      'https://images.unsplash.com/photo-1553621042-f6e147245754?w=400&h=300&fit=crop',
      'rolls',
      0,
      1
    );
    
    await addProduct(
      '–•—Ä—É—Å—Ç—è—â–∞—è –∞—Ä–∏–≥–∞—Ç–æ',
      '–†–∏—Å 100 –≥—Ä, –Ω–æ—Ä–∏ 1 —à—Ç, –∫–∞—Ç–∞–∏—Ñ–∏ 30 –≥—Ä, –∫—Ä–µ–≤–µ—Ç–∫–∏ 20 –≥—Ä, –æ–≥—É—Ä–µ—Ü 20 –≥—Ä, —Å–æ—É—Å –∞—Ä–∏–≥–∞—Ç–æ 20 –≥—Ä, —É–Ω–∞–≥–∏ 10 –≥—Ä',
      540,
      'https://images.unsplash.com/photo-1553621042-f6e147245754?w=400&h=300&fit=crop',
      'rolls',
      0,
      1
    );
    
    await addProduct(
      '–ö—Ä–µ–≤–µ—Ç–∫–∏ —Å —Ç–∞–º–∞–≥–æ',
      '–†–∏—Å 110 –≥—Ä, —Å—ã—Ä 20 –≥—Ä, –Ω–æ—Ä–∏ 1 —à—Ç, —Ç–æ–±–∏–∫–æ 10 –≥—Ä, –æ–º–ª–µ—Ç 20 –≥—Ä, –æ–≥—É—Ä–µ—Ü 20 –≥—Ä, –∫—Ä–µ–≤–µ—Ç–∫–∏ 40 –≥—Ä, —Å–æ—É—Å —Å–ø–∞–π—Å 20 –≥—Ä',
      580,
      'https://images.unsplash.com/photo-1553621042-f6e147245754?w=400&h=300&fit=crop',
      'rolls',
      0,
      1
    );
    
    await addProduct(
      '–û–ø–∞–ª–µ–Ω–Ω—ã–π —Å –ª–æ—Å–æ—Å–µ–º',
      '–†–∏—Å 120 –≥—Ä, —Å—ã—Ä 30 –≥—Ä, –Ω–æ—Ä–∏ 1 —à—Ç, –æ–≥—É—Ä–µ—Ü 20 –≥—Ä, –ª–æ—Å–æ—Å—å 50 –≥—Ä, —É–Ω–∞–≥–∏ 15 –≥—Ä, –∫—É–Ω–∂—É—Ç 5 –≥—Ä',
      520,
      'https://images.unsplash.com/photo-1553621042-f6e147245754?w=400&h=300&fit=crop',
      'rolls',
      0,
      1
    );
    
    await addProduct(
      '–ö–∏–æ—Ç–æ',
      '–†–∏—Å 140 –≥—Ä, –Ω–æ—Ä–∏ 1 —à—Ç, —Å—ã—Ä 30 –≥—Ä, –æ–≥—É—Ä–µ—Ü 20 –≥—Ä, –∫—Ä–µ–≤–µ—Ç–∫–∏ 20 –≥—Ä, –∫—É–Ω–∂—É—Ç 20 –≥—Ä, —Å–æ—É—Å –¥–ª—è –∑–∞–ø–µ–∫–∞–Ω–∏—è 50 –≥—Ä',
      560,
      'https://images.unsplash.com/photo-1553621042-f6e147245754?w=400&h=300&fit=crop',
      'rolls',
      0,
      1
    );
    
    await addProduct(
      '–§–∏–ª–∞–¥–µ–ª—å—Ñ–∏—è —Å —É–≥—Ä—ë–º',
      '–†–∏—Å 100 –≥—Ä, –Ω–æ—Ä–∏ 1 —à—Ç, —Å—ã—Ä 30 –≥—Ä, –æ–≥—É—Ä–µ—Ü 20 –≥—Ä, —É–≥–æ—Ä—å 50 –≥—Ä, —É–Ω–∞–≥–∏ 5 –≥—Ä, –∫—É–Ω–∂—É—Ç 5 –≥—Ä',
      550,
      'https://images.unsplash.com/photo-1553621042-f6e147245754?w=400&h=300&fit=crop',
      'rolls',
      1,
      1
    );
    
    // –ù–æ–≤—ã–µ –Ω–∞–ø–∏—Ç–∫–∏
    console.log('\nü•§ –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –Ω–∞–ø–∏—Ç–∫–∏...');
    
    await addProduct(
      '–§–∞–Ω—Ç–∞ 0.5–ª',
      '–û—Å–≤–µ–∂–∞—é—â–∏–π –∞–ø–µ–ª—å—Å–∏–Ω–æ–≤—ã–π –Ω–∞–ø–∏—Ç–æ–∫',
      120,
      'https://images.unsplash.com/photo-1505253716333-d283d2b74e50?w=400&h=300&fit=crop',
      'drinks',
      1,
      1
    );
    
    await addProduct(
      '–§–∞–Ω—Ç–∞ 1–ª',
      '–û—Å–≤–µ–∂–∞—é—â–∏–π –∞–ø–µ–ª—å—Å–∏–Ω–æ–≤—ã–π –Ω–∞–ø–∏—Ç–æ–∫',
      180,
      'https://images.unsplash.com/photo-1505253716333-d283d2b74e50?w=400&h=300&fit=crop',
      'drinks',
      0,
      1
    );
    
    await addProduct(
      '–ö–æ–ª–∞ 0.5–ª',
      '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –≥–∞–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞–ø–∏—Ç–æ–∫',
      120,
      'https://images.unsplash.com/photo-1505253716333-d283d2b74e50?w=400&h=300&fit=crop',
      'drinks',
      1,
      1
    );
    
    await addProduct(
      '–ö–æ–ª–∞ 1–ª',
      '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –≥–∞–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞–ø–∏—Ç–æ–∫',
      180,
      'https://images.unsplash.com/photo-1505253716333-d283d2b74e50?w=400&h=300&fit=crop',
      'drinks',
      0,
      1
    );
    
    await addProduct(
      'Fuse Tea –†–æ–º–∞—à–∫–∞',
      '–£—Å–ø–æ–∫–∞–∏–≤–∞—é—â–∏–π —á–∞–π —Å —Ä–æ–º–∞—à–∫–æ–π',
      100,
      'https://images.unsplash.com/photo-1505253716333-d283d2b74e50?w=400&h=300&fit=crop',
      'drinks',
      0,
      1
    );
    
    await addProduct(
      'Fuse Tea –ü–µ—Ä—Å–∏–∫',
      '–û—Å–≤–µ–∂–∞—é—â–∏–π —á–∞–π —Å –ø–µ—Ä—Å–∏–∫–æ–º',
      100,
      'https://images.unsplash.com/photo-1505253716333-d283d2b74e50?w=400&h=300&fit=crop',
      'drinks',
      0,
      1
    );
    
    console.log('\n‚úÖ –í—Å–µ –Ω–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!');
    
  } catch (error) {
    console.error('\n‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤:', error.message);
    throw error;
  }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
function checkResult() {
  return new Promise((resolve, reject) => {
    console.log('\nüîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç...');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
    const categories = ['rolls', 'sets', 'snacks', 'wings', 'drinks', 'sauces', 'pizza'];
    
    categories.forEach(category => {
      db.get('SELECT COUNT(*) as count FROM products WHERE category = ?', [category], (err, result) => {
        if (err) {
          console.error(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ${category}:`, err.message);
        } else {
          console.log(`üìä ${category}: ${result.count} —Ç–æ–≤–∞—Ä–æ–≤`);
        }
      });
    });
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
    db.get('SELECT COUNT(*) as total FROM products', (err, result) => {
      if (err) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞:', err.message);
        reject(err);
      } else {
        console.log(`üìä –í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤: ${result.total}`);
        resolve();
      }
    });
  });
}

// –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
async function main() {
  try {
    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã
    await addNewProducts();
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    await checkResult();
    
    console.log('\n‚úÖ –°–∫—Ä–∏–ø—Ç –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
    
  } catch (error) {
    console.error('\n‚ùå –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞:', error.message);
    process.exit(1);
  } finally {
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
    db.close((err) => {
      if (err) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:', err.message);
      } else {
        console.log('üîí –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –∑–∞–∫—Ä—ã—Ç–æ');
      }
      process.exit(0);
    });
  }
}

// –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∫—Ä–∏–ø—Ç
main();
