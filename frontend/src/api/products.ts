import { Product, ProductCategory } from '../types';
import { client } from './client';

export const productsApi = {
  // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø—Ä–æ–¥—É–∫—Ç—ã
  getAll: async (): Promise<Product[]> => {
    try {
      console.log('üîç –ó–∞–ø—Ä–æ—Å —Ç–æ–≤–∞—Ä–æ–≤...');
      const response = await client.get('/products');
      console.log('‚úÖ –ü–æ–ª—É—á–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤:', response.data?.length || 0);
      
      if (response.data && Array.isArray(response.data)) {
        return response.data;
      } else {
        console.error('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:', response.data);
        return [];
      }
    } catch (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤:', error);
      return [];
    }
  },

  // –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  getByCategory: async (category: ProductCategory): Promise<Product[]> => {
    try {
      const response = await client.get(`/products?category=${category}`);
      return response.data || [];
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:', error);
      return [];
    }
  },

  // –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã
  getPopular: async (): Promise<Product[]> => {
    try {
      const response = await client.get('/products');
      // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–≤—ã–µ 6 —Ç–æ–≤–∞—Ä–æ–≤ –∫–∞–∫ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ
      return (response.data || []).slice(0, 6);
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤:', error);
      return [];
    }
  },

  // –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç –ø–æ ID
  getById: async (id: string): Promise<Product> => {
    try {
      const response = await client.get(`/products/${id}`);
      return response.data;
    } catch (error) {
      throw new Error('–ü—Ä–æ–¥—É–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
    }
  },

  // –ü–æ–∏—Å–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
  search: async (query: string): Promise<Product[]> => {
    try {
      const response = await client.get(`/products?search=${encodeURIComponent(query)}`);
      return response.data || [];
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤:', error);
      return [];
    }
  },
};
