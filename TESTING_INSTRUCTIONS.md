# Инструкция по тестированию FreedomPay интеграции

## Шаг 1: Создание таблиц платежей

```bash
cd backend
node create_payment_tables.js
```

## Шаг 2: Создание тестового заказа

```bash
node create_test_order.js
```

Это создаст тестовый заказ с ID и суммой для тестирования.

## Шаг 3: Запуск тестового сервера

В первом терминале:

```bash
node start-test-server.js
```

Сервер запустится на порту 3000.

## Шаг 4: Тестирование интеграции

Во втором терминале:

```bash
node test_freedompay.js
```

## Что происходит в тестовом режиме:

### 1. Инициализация платежа
- Возвращает мок-ответ от FreedomPay
- Создает запись в таблице `payment_transactions`
- Обновляет статус заказа на `processing`

### 2. Webhook обработка
- Принимает любые данные (без проверки подписи)
- Обновляет статус транзакции
- Обновляет статус заказа

### 3. Проверка платежа
- Всегда разрешает платеж для тестирования
- Проверяет существование заказа и сумму

### 4. Healthcheck
- Всегда возвращает `healthy: true`

## Проверка в браузере:

1. **Главная страница**: http://localhost:3000
2. **Healthcheck**: http://localhost:3000/health
3. **FreedomPay health**: http://localhost:3000/api/payments/freedompay/health

## Проверка базы данных:

```bash
sqlite3 data/mnogo_rolly.db
```

```sql
-- Посмотреть тестовый заказ
SELECT * FROM orders WHERE customer_name = 'Тестовый Клиент';

-- Посмотреть транзакции
SELECT * FROM payment_transactions;

-- Посмотреть логи
SELECT * FROM payment_logs;
```

## Переход в продакшн:

1. Замените `http://localhost:3000` на ваш домен в `paymentRoutes.js`
2. Уберите мок-ответы и подключите реальный FreedomPay API
3. Включите проверку подписи в webhook'ах
4. Настройте URL в панели FreedomPay

## Устранение проблем:

### Сервер не запускается:
- Проверьте, что порт 3000 свободен
- Убедитесь, что все зависимости установлены

### Тесты не проходят:
- Убедитесь, что сервер запущен
- Проверьте логи сервера
- Убедитесь, что тестовый заказ создан

### Ошибки базы данных:
- Проверьте, что таблицы созданы
- Убедитесь в правильности путей к БД
